{% extends "base.html" %}

{% block title %}{% if announcement %}Editar Anúncio{% else %}Novo Anúncio{% endif %} - Admin Prima Arte{% endblock %}

{% block content %}
<div class="admin-nav">
    <div class="container">
        <h1><i class="fas fa-{% if announcement %}edit{% else %}plus-circle{% endif %}"></i> {% if announcement %}Editar: {{ announcement.title }}{% else %}Novo Anúncio{% endif %}</h1>
        <div class="nav-links">
            <a href="{{ url_for('admin_announcements') }}"><i class="fas fa-arrow-left"></i> Voltar</a>
            <a href="{{ url_for('admin_dashboard') }}"><i class="fas fa-dashboard"></i> Dashboard</a>
        </div>
    </div>
</div>

<section class="section">
    <div class="container">
        <div style="max-width: 800px; margin: 0 auto;">
            <form action="{{ url_for('admin_save_announcement') }}" method="post" enctype="multipart/form-data" style="background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                {% if announcement %}
                <input type="hidden" name="id" value="{{ announcement.id }}">
                {% endif %}
                
                <div style="display: grid; gap: 1.5rem;">
                    <!-- Título -->
                    <div>
                        <label style="display: block; font-weight: 600; color: var(--dark-brown); margin-bottom: 0.5rem;">
                            <i class="fas fa-heading"></i> Título do Anúncio *
                        </label>
                        <input type="text" name="title" required
                               style="width: 100%; padding: 1rem; border: 2px solid var(--primary-beige); border-radius: 10px; font-size: 1rem; font-family: var(--font-body);"
                               placeholder="Ex: Promoção de Inverno!"
                               value="{% if announcement %}{{ announcement.title }}{% endif %}">
                    </div>
                    
                    <!-- Conteúdo -->
                    <div>
                        <label style="display: block; font-weight: 600; color: var(--dark-brown); margin-bottom: 0.5rem;">
                            <i class="fas fa-align-left"></i> Conteúdo *
                        </label>
                        <textarea name="content" rows="5" required
                                  style="width: 100%; padding: 1rem; border: 2px solid var(--primary-beige); border-radius: 10px; font-family: var(--font-body); resize: vertical;"
                                  placeholder="Descreva o anúncio, promoção ou novidade...">{% if announcement %}{{ announcement.content }}{% endif %}</textarea>
                    </div>
                    
                    <!-- Upload de Imagem -->
                    <div>
                        <label style="display: block; font-weight: 600; color: var(--dark-brown); margin-bottom: 0.5rem;">
                            <i class="fas fa-image"></i> Imagem do Anúncio (opcional)
                        </label>
                        
                        {% if announcement and announcement.image %}
                        <div style="margin-bottom: 1rem;">
                            <p style="color: var(--gray); margin-bottom: 0.5rem;">Imagem atual:</p>
                            <img src="{{ announcement.image }}" alt="{{ announcement.title }}" 
                                 style="max-width: 300px; max-height: 200px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        </div>
                        {% endif %}
                        
                        <div style="border: 2px dashed var(--primary-beige); border-radius: 10px; padding: 2rem; text-align: center;">
                            <input type="file" name="image" accept="image/*" id="imageUpload"
                                   style="display: none;" 
                                   onchange="previewAnnouncementImage(this)">
                            
                            <div id="imagePreview" style="margin-bottom: 1rem;">
                                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--primary-teal); margin-bottom: 1rem;"></i>
                                <p style="color: var(--gray); margin: 0;">
                                    {% if announcement and announcement.image %}
                                        Clique para alterar a imagem
                                    {% else %}
                                        Clique para adicionar uma imagem
                                    {% endif %}
                                </p>
                            </div>
                            
                            <button type="button" onclick="document.getElementById('imageUpload').click()" 
                                    class="btn-upload">
                                <i class="fas fa-upload"></i> 
                                {% if announcement and announcement.image %}Alterar Imagem{% else %}Adicionar Imagem{% endif %}
                            </button>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--gray); margin-top: 0.5rem;">
                            Formatos aceitos: JPG, PNG, GIF. Tamanho máximo: 5MB
                        </p>
                    </div>
                    
                    <!-- Status Ativo -->
                    <div>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" name="active" 
                                   style="width: 20px; height: 20px; accent-color: var(--primary-teal);"
                                   {% if not announcement or announcement.active %}checked{% endif %}>
                            <span style="font-weight: 600; color: var(--dark-brown);">
                                <i class="fas fa-eye"></i> Anúncio Ativo
                            </span>
                        </label>
                        <p style="font-size: 0.8rem; color: var(--gray); margin-top: 0.5rem; margin-left: 1.5rem;">
                            Anúncios ativos aparecem na página inicial do site
                        </p>
                    </div>
                </div>
                
                <!-- Botões -->
                <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                    <button type="submit" class="btn-primary-large">
                        <i class="fas fa-save"></i> 
                        {% if announcement %}Atualizar Anúncio{% else %}Salvar Anúncio{% endif %}
                    </button>
                    <a href="{{ url_for('admin_announcements') }}" class="btn-secondary-large">
                        <i class="fas fa-times"></i> Cancelar
                    </a>
                </div>
            </form>
            
            <!-- Dica -->
            <div style="background: linear-gradient(135deg, var(--primary-beige), var(--cream)); padding: 1.5rem; border-radius: 15px; margin-top: 2rem; border-left: 5px solid var(--primary-teal);">
                <h4 style="color: var(--primary-teal); margin-bottom: 1rem;">
                    <i class="fas fa-lightbulb"></i> Dicas para Anúncios Eficazes
                </h4>
                <ul style="color: var(--gray); line-height: 1.6; margin: 0;">
                    <li><strong>Título chamativo:</strong> Use palavras que despertem interesse</li>
                    <li><strong>Conteúdo claro:</strong> Seja direto sobre a promoção ou novidade</li>
                    <li><strong>Imagem atrativa:</strong> Use cores vibrantes que chamem atenção</li>
                    <li><strong>Call to action:</strong> Incentive a ação (compre, visite, conheça)</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<script>
function previewAnnouncementImage(input) {
    const previewContainer = document.getElementById('imagePreview');
    const file = input.files[0];
    
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        alert('Por favor, selecione apenas arquivos de imagem.');
        input.value = '';
        return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
        alert('A imagem deve ter no máximo 5MB.');
        input.value = '';
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        previewContainer.innerHTML = `
            <img src="${e.target.result}" alt="Preview" 
                 style="max-width: 300px; max-height: 200px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <p style="color: var(--primary-teal); font-weight: 600; margin-top: 1rem; margin-bottom: 0;">
                Imagem selecionada: ${file.name}
            </p>
        `;
    };
    reader.readAsDataURL(file);
}
</script>

<style>
.admin-nav {
    background: var(--dark-brown);
    padding: 1rem 0;
    margin-bottom: 2rem;
}

.admin-nav .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.admin-nav h1 {
    color: var(--primary-gold);
    font-family: var(--font-heading);
    margin: 0;
}

.admin-nav .nav-links {
    display: flex;
    gap: 1rem;
}

.admin-nav .nav-links a {
    color: var(--cream);
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    transition: all 0.3s ease;
}

.admin-nav .nav-links a:hover {
    background: var(--primary-gold);
    color: var(--dark-brown);
}

@media (max-width: 768px) {
    .admin-nav .container {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>
{% endblock %}